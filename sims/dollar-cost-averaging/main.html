<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dollar-Cost Averaging Simulator</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: system-ui, -apple-system, sans-serif; background: #f8f9fa; padding: 20px; color: #333; }
        .container { max-width: 900px; margin: 0 auto; background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); padding: 24px; }
        h1 { font-size: 22px; margin-bottom: 6px; color: #1a5f7a; text-align: center; }
        .subtitle { text-align: center; color: #666; font-size: 13px; margin-bottom: 24px; }
        .controls { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-bottom: 24px; }
        .control-group { display: flex; flex-direction: column; gap: 8px; }
        label { font-size: 13px; font-weight: 600; color: #555; }
        .input-row { display: flex; gap: 10px; align-items: center; }
        input[type="range"] { flex: 1; height: 6px; border-radius: 3px; outline: none; -webkit-appearance: none; background: #e0e0e0; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 18px; height: 18px; border-radius: 50%; background: #1a5f7a; cursor: pointer; }
        input[type="number"] { width: 80px; padding: 6px; border: 1px solid #ddd; border-radius: 6px; font-size: 13px; text-align: center; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 14px; margin-bottom: 24px; }
        .stat { border-radius: 10px; padding: 14px; text-align: center; background: #f0f7fa; }
        .stat.highlight { background: #d4edda; }
        .stat .val { font-size: 24px; font-weight: 800; color: #1a5f7a; }
        .stat.highlight .val { color: #155724; }
        .stat .lbl { font-size: 12px; color: #666; margin-top: 4px; }
        .insight { background: #fff3cd; border-left: 4px solid #ffc107; padding: 12px 16px; border-radius: 6px; font-size: 13px; margin-bottom: 20px; }
        .seed-btn { margin-bottom: 12px; padding: 6px 16px; background: #1a5f7a; color: white; border: none; border-radius: 6px; font-size: 12px; cursor: pointer; }
        .seed-btn:hover { background: #145068; }
    </style>
</head>
<body>
<div class="container">
    <h1>Dollar-Cost Averaging Simulator</h1>
    <p class="subtitle">See how investing a fixed amount monthly compares to a lump sum, even through market ups and downs.</p>

    <div class="controls">
        <div class="control-group">
            <label>Monthly Investment ($)</label>
            <div class="input-row">
                <input type="range" id="monthly" min="25" max="2000" step="25" value="100" oninput="sync('monthly',this.value)">
                <input type="number" id="monthlyNum" value="100" min="25" max="2000" step="25" oninput="sync('monthly',this.value)">
            </div>
        </div>
        <div class="control-group">
            <label>Years</label>
            <div class="input-row">
                <input type="range" id="years" min="1" max="30" step="1" value="10" oninput="sync('years',this.value)">
                <input type="number" id="yearsNum" value="10" min="1" max="30" step="1" oninput="sync('years',this.value)">
            </div>
        </div>
        <div class="control-group">
            <label>Avg Annual Return (%)</label>
            <div class="input-row">
                <input type="range" id="avgReturn" min="2" max="15" step="0.5" value="8" oninput="sync('avgReturn',this.value)">
                <input type="number" id="avgReturnNum" value="8" min="2" max="15" step="0.5" oninput="sync('avgReturn',this.value)">
            </div>
        </div>
        <div class="control-group">
            <label>Market Volatility</label>
            <div class="input-row">
                <select id="volatility" onchange="recalc()" style="flex:1;padding:7px;border:1px solid #ddd;border-radius:6px;font-size:13px;background:white;">
                    <option value="low">Low (bonds)</option>
                    <option value="medium" selected>Medium (index fund)</option>
                    <option value="high">High (individual stocks)</option>
                </select>
            </div>
        </div>
    </div>

    <button class="seed-btn" onclick="newSeed()">ðŸŽ² Randomize Market Path</button>

    <div class="stats">
        <div class="stat">
            <div class="val" id="totalInvested">$0</div>
            <div class="lbl">Total Invested (DCA)</div>
        </div>
        <div class="stat highlight">
            <div class="val" id="dcaFinal">$0</div>
            <div class="lbl">DCA Final Value</div>
        </div>
        <div class="stat">
            <div class="val" id="lumpFinal">$0</div>
            <div class="lbl">Lump Sum Final Value</div>
        </div>
        <div class="stat highlight">
            <div class="val" id="dcaProfit">$0</div>
            <div class="lbl">DCA Total Gain</div>
        </div>
        <div class="stat">
            <div class="val" id="avgCost">$0</div>
            <div class="lbl">DCA Avg Cost/Share</div>
        </div>
    </div>

    <div class="insight" id="insight"></div>

    <canvas id="chart"></canvas>
</div>
<script>
let chart, seed = 42;

function sync(id, val) {
    document.getElementById(id).value = val;
    document.getElementById(id + 'Num').value = val;
    recalc();
}

function newSeed() { seed = Math.floor(Math.random() * 10000); recalc(); }

function seededRandom(s) {
    let x = Math.sin(s) * 10000;
    return x - Math.floor(x);
}

function fmt(n) { return '$' + Math.round(n).toLocaleString(); }

function recalc() {
    const monthly = parseFloat(document.getElementById('monthly').value);
    const years = parseInt(document.getElementById('years').value);
    const avgReturn = parseFloat(document.getElementById('avgReturn').value) / 100;
    const volLevel = document.getElementById('volatility').value;
    const volMap = { low: 0.05, medium: 0.15, high: 0.35 };
    const vol = volMap[volLevel];

    const months = years * 12;
    const lumpSum = monthly * months;

    // Generate monthly returns using seeded random
    const returns = [];
    let s = seed;
    for (let i = 0; i < months; i++) {
        s++;
        const r1 = seededRandom(s); s++;
        const r2 = seededRandom(s);
        // Box-Muller for normal distribution
        const z = Math.sqrt(-2 * Math.log(r1)) * Math.cos(2 * Math.PI * r2);
        const monthlyRet = (avgReturn / 12) + vol / Math.sqrt(12) * z;
        returns.push(monthlyRet);
    }

    // Simulate price starting at $100
    let price = 100;
    const prices = [price];
    returns.forEach(r => { price *= (1 + r); prices.push(Math.max(price, 1)); });

    // DCA simulation
    let shares = 0;
    let totalInvested = 0;
    const dcaValues = [0];
    for (let i = 0; i < months; i++) {
        shares += monthly / prices[i + 1];
        totalInvested += monthly;
        dcaValues.push(shares * prices[i + 1]);
    }

    // Lump sum simulation
    const lumpShares = lumpSum / prices[0];
    const lumpValues = prices.slice(1).map(p => lumpShares * p);

    const dcaFinal = dcaValues[dcaValues.length - 1];
    const lumpFinal = lumpValues[lumpValues.length - 1];
    const avgCost = totalInvested / shares;

    document.getElementById('totalInvested').textContent = fmt(totalInvested);
    document.getElementById('dcaFinal').textContent = fmt(dcaFinal);
    document.getElementById('lumpFinal').textContent = fmt(lumpFinal);
    document.getElementById('dcaProfit').textContent = fmt(dcaFinal - totalInvested);
    document.getElementById('avgCost').textContent = '$' + avgCost.toFixed(2);

    const insight = dcaFinal > totalInvested
        ? `DCA turned ${fmt(totalInvested)} into ${fmt(dcaFinal)} â€” a gain of ${fmt(dcaFinal - totalInvested)} (${((dcaFinal/totalInvested - 1)*100).toFixed(1)}%). Your average cost per share was $${avgCost.toFixed(2)}, versus the final price of $${prices[prices.length-1].toFixed(2)}.`
        : `Even with a down market, DCA limited your losses by buying more shares when prices were lower. Try increasing the time horizon.`;
    document.getElementById('insight').textContent = insight;

    // Chart labels (yearly)
    const labels = ['Start'];
    for (let y = 1; y <= years; y++) { labels.push('Yr ' + y); }
    const dcaYearly = [0];
    const lumpYearly = [lumpSum];
    for (let y = 1; y <= years; y++) {
        dcaYearly.push(dcaValues[y * 12]);
        lumpYearly.push(lumpValues[y * 12 - 1]);
    }

    if (!chart) {
        chart = new Chart(document.getElementById('chart'), {
            type: 'line',
            data: {
                labels,
                datasets: [
                    { label: 'DCA Value', data: dcaYearly, borderColor: '#1a5f7a', backgroundColor: '#1a5f7a20', tension: 0.3, borderWidth: 2 },
                    { label: 'Lump Sum Value', data: lumpYearly, borderColor: '#e74c3c', backgroundColor: '#e74c3c10', tension: 0.3, borderWidth: 2, borderDash: [5,5] },
                    { label: 'Total Invested', data: Array.from({length: years+1}, (_, i) => monthly * i * 12), borderColor: '#aaa', borderDash: [3,3], tension: 0, borderWidth: 1, pointRadius: 0 }
                ]
            },
            options: { responsive: true, plugins: { legend: { position: 'bottom' } }, scales: { y: { ticks: { callback: v => '$' + (v/1000).toFixed(0) + 'k' } } } }
        });
    } else {
        chart.data.labels = labels;
        chart.data.datasets[0].data = dcaYearly;
        chart.data.datasets[1].data = lumpYearly;
        chart.data.datasets[2].data = Array.from({length: years+1}, (_, i) => monthly * i * 12);
        chart.update();
    }
}

recalc();
</script>
</body>
</html>
